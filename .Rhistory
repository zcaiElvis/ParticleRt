t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
while(xnext < 0.5 || xnext > 10 ){
xnext <- rnorm(1, x, sd = sigma1)
}
c(x = xnext)
},
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = x*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2, scale = 2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
plot(result_covid_simple$cond.logLik)
result_covid_simple$cond.logLik
result_covid_simple$filter.mean.x
plot(result_covid_simple$filter.mean.x)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 1000,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
}
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2, scale = 2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 100,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
}
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 100,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
}
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 100,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
}
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 100,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
},
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 1000,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1.5),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
},
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
library("tidyverse")
library("dplyr")
library("zoo")
library("pomp")
### Read Data ###
covid_data <- read.csv("data/case_death.csv", header=TRUE)
covid_data <- covid_data %>%
filter(Country_code == "CA") %>%
# select(c("Date_reported", "New_cases")) %>%
select(c("New_cases")) %>%
mutate(y = New_cases)
covid_data <- covid_data[50:nrow(covid_data)-5,]
covid_data$y <- rollmean(covid_data$y, k = 7, fill =NA)
covid_data <- na.omit(covid_data)
covid_data$y <- round(covid_data$y)
covid_data$idx <- 1:nrow(covid_data)
covid_simple<- pfilter(
Np = 1000,
times = "idx",
t0 = 1,
data = covid_data,
rinit = function(x0, ...){
c(x = x0)
},
### Plugging in initial values here
params = c(sigma1 = 0.2, x0=1),
### rprocess ###
rprocess = discrete_time(
function(x, sigma1, ...){
xnext <- rnorm(1, x, sd = sigma1)
c(x = xnext)
},
# function(x, sigma1, ...){
#   xnext <- rnorm(1, x, sd = sigma1)
#   while(xnext < 0.5 || xnext > 10 ){
#     xnext <- rnorm(1, x, sd = sigma1)
#   }
#   c(x = xnext)
# },
delta.t = 1
),
### dmeasure ###
dmeasure = function (t, x, T, Y, y, ..., log) {
lambda = abs(x)*sum(Y[t-1:1] * dgamma(1:t-1, shape = 2.2, scale = 2.2))
dpois(y, lambda = lambda)
},
T = t, Y = covid_data$New_cases,
statenames = "x",
pred.mean = TRUE,
pred.var = TRUE,
filter.mean = TRUE,
filter.traj = TRUE,
verbose=FALSE
)
# est_rt <- get_est_Rt(case = covid_data$New_cases)
#
# plot_case_Rt(covid_data, data.frame(pred.mean.x = est_rt))
result_covid_simple <- as.data.frame(covid_simple)
plot(result_covid_simple$pred.mean.x)
plot_case_Rt(covid_data, result_covid_simple)
source("functions/plot_case_Rt.R")
plot_case_Rt(covid_data, result_covid_simple)
source("functions/get_est_Rt.R")
est_rt <- get_est_Rt(case = covid_data$New_cases)
plot(result_covid_simple$pred.mean.x, est_rt)
result_covid_simple$ess
result_covid_simple$ess
v <- dgamma(1:40, shape = 2, scale 2)
v <- dgamma(1:40, shape = 2, scale= 2)
plot(v)
sum(v)
v <- dgamma(1:1000, shape = 2, scale= 2)
sum(v)
pgamma(1, shape = 2, scale = 2)
v< pgamma(1:40, shape = 2, scale = 2)
v<-pgamma(1:40, shape = 2, scale = 2)
c(0, v)
v <- diff(c(0, v) )
plot(v)
length(v)
v <- 40:1
t = 40
T
v[t-1:1]
t-1:1
(t-1):1
v <- diff(c(0, pgamma(1:40, scale =2, shape=2)) )
plot(v)
v1 <- dgamma(1:40, shape = 2, scale = 2)
plot(v1-v)
v2 <- log(1:20)
v2 <- log(seq(0.8, 1.2, 0.01))
gen_covid_rw <- function(len, sd1 = 0.3, x0 = 1.2, y0 = 1, a = 2, b = 2){
x <- rep(0, len)
y <- rep(0, len)
ls <- rep(0, len)
cut = 10
x[1:cut] = x0
y[1:cut] = y0
w_all <- dgamma(1:len, shape = a, scale = b)
### Generate R ###
for(i in 2:len){
x[i] <- rnorm(1, x[i-1], sd1)
while(x[i] < 0.5 || x[i] > 3 ){
x[i] <- rnorm(1, x[i-1], sd1)
}
}
for(j in cut:len){
rate <- x[j] * sum(y[j-1:1] * w_all[1:j-1])
ls[j] <- rate
y[j] <- rpois(1, lambda = rate)
}
return(data.frame(idx = 1:len, x=x, y=y, lambdas = ls))
}
gen_covid_rw(100)
gen_covid <- gen_covid_rw(100)
plot(gen_covid$y)
plot(gen_covid$x)
